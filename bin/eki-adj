#!/bin/bash -e

[ "$1" = "-h" ] && {
	cat >&2 <<- EOF
	eki-adj 0.1.1
	Copyright (C) 2021, Ryuichi Ueda.

	Usage: eki-adj [option]

	MIT License
	Released under MIT license
	https://github.com/ryuichiueda/eki
	EOF
	exit 0
}

RAWDATA=/usr/share/eki/raw
[ -e "$RAWDATA" ] || RAWDATA="/eki/raw"
[ -e "$RAWDATA" ] || RAWDATA="$(dirname $0)/../eki/raw"

BIN=$(dirname $0)

grep -C3 ">$1<" "$RAWDATA/n/"*.xml                                    |
awk -F '[<>]' -v s="$1" '{gsub(/station_/,"",$2);a[$2]=$3}
	$2=="name2"&&a["name2"]==s{print a["cd1"]}
	$2=="name2"&&a["name1"]==s{print a["cd2"]}'                |
xargs -n1 $BIN/eki-c                                               |
awk '{print $2,$4}'
